#### Bash customization. ####
export PS1="\w $ "
export CLICOLOR=yes                                   # Enable color ls output
export TERM=xterm-color                               # Flag terminal as color-capable
export GREP_OPTIONS='--color=auto'
# Ref: http://excid3.com/blog/how-to-fix-esc-in-your-terminal/#.UkHeamSZ3d6
export LESS="-eirMX"
# Show auto-completion on first tab (default is second tab).
bind 'set show-all-if-ambiguous on'
# When completing cd and rmdir, only dirs should be possible option (default is
# all files on Mac).
complete -d cd rmdir

# Better completion for killall and killps
_killall()
{
    local cur prev
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}

    #  Get a list of processes
    #+ (the first sed evaluation
    #+ takes care of swapped out processes, the second
    #+ takes care of getting the basename of the process).
    COMPREPLY=( $( ps -u $USER -o comm  | \
        sed -e '1,1d' -e 's#[]\[]##g' -e 's#^.*/##'| \
        awk '{if ($0 ~ /^'$cur'/) print $0}' ))

    return 0
}
complete -F _killall killall killps
# No empty command completion.
shopt -s no_empty_cmd_completion

## Bash History customization.
# avoid duplicates..
export HISTCONTROL=ignoredups:erasedups  
# append (not ovewrite) history entries..
shopt -s histappend
# Larger bash history (default is 500)
export HISTFILESIZE=10000
export HISTSIZE=10000

# Enable X11 tunneling through ssh
if [ -z $DISPLAY ]; then export DISPLAY=":0.0"; fi

#### Aliases ####
# force X11 tunneling through ssh
alias ssh='ssh -Y'
# Some more aliases.
alias ..='cd ..'
# Pretty printed python code.
alias c="pygmentize -O style=monokai -f console256 -g"
alias d="du -h -d=1"
alias df="df -h"
alias grep='GREP_COLOR="1;37;45" LANG=C grep --color=auto'
alias httpdump="sudo tcpdump -i en0 -n -s 0 -w - | grep -a -o -E \"Host\: .*|GET \/.*\""
alias publicip="curl -s http://checkip.dyndns.com/ | sed 's/[^0-9\.]//g'"
alias localip="ipconfig getifaddr en0"
# Tree
if [ ! -x "$(which tree 2>/dev/null)" ]
then
  alias tree="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"
fi

#### Add some paths to $PATH. ####
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
export PATH=$PATH:$HOME/android_sdk/build-tools:$HOME/android_sdk/platform-tools
export PATH=$PATH:$HOME/android_sdk/tools
export PATH=$PATH:$DIR/scripts

#### Android reverse-engineering related aliases. ####
alias aapt="$HOME/tools/android/aapt"
alias apktool="java -jar $HOME/tools/android/apktool.jar"
alias burp="java -jar $HOME/Tools/burpsuite_free_v1.5.jar"
alias dex2jar=$HOME/tools/android/dex2jar-0.0.9.15/d2j-dex2jar.sh
if [ "$(uname)" == "Darwin" ]; then
	alias jd-gui="/Applications/JD-GUI.app/Contents/MacOS/jd-gui"
	alias jad="$HOME/tools/android/jad158g.mac.intel/jad"
else
	alias jd-gui="$HOME/AndroidTools/jd-gui/jd-gui"
fi
alias printcert="keytool -printcert -file"
alias signapk="jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore alias_name"
alias android_screenshot="java -jar $HOME/tools/android/AndroidScreenCapture_1.1/AShot-1.1.jar"
# Mac style pbcopy and pbpaste on linux.
command -v xsel 1>/dev/null &&
  alias pbcopy='xsel --clipboard --input' &&
	alias pbpaste='xsel --clipboard --output'
# These are for compiling android code.
# export NDK=$HOME/android-sdk-mac_x86/android-ndk-r8b
# SYSROOT=$NDK/platforms/android-14/arch-arm
# export ANDROID_CC="${NDK}/toolchains/arm-linux-androideabi-4.4.3/prebuilt/darwin-x86/bin/arm-linux-androideabi-gcc
#   --sysroot=$SYSROOT " #-B /usr/local/google/android_src_code/system/core/include"

#### Source more scripts. ####
# adb auto-completion.
source $DIR/bashrc_includes/adb.bash
# git auto-completion.
source $DIR/bashrc_includes/git-completion.bash
# An interesting bash prompt.
source $DIR/bashrc_includes/50_prompt.sh
# SSH auto-completion based on entries in known_hosts.
if [[ -e ~/.ssh/known_hosts ]]; then
  complete -o default -W "$(cat ~/.ssh/known_hosts | sed 's/[, ].*//' | sort | uniq | grep -v '[0-9]')" ssh scp stfp
fi
# Source 'z' - easy jumping around without providing full path names.
source $DIR/bashrc_includes/z/z.sh

#### Ubuntu specific settings. ####
# Save gnome session on exit.
command -v dconf 1>/dev/null &&
 dconf write /org/gnome/gnome-session/auto-save-session true 1>/dev/null &&
# Show date and day in the clock in Gnome.
command -v gsettings 1>/dev/null &&
	gsettings set com.canonical.indicator.datetime show-clock true &&
	gsettings set com.canonical.indicator.datetime show-day true &&
	gsettings set com.canonical.indicator.datetime show-date true
